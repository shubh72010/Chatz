<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Strait Chat</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #222;
      padding: 10px 20px;
      border-bottom: 2px solid #6200ea;
    }

    #user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #user-pic {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: none;
    }

    #user-name {
      font-weight: bold;
      display: none;
    }

    #cult-symbol {
      font-size: 1.5em;
      color: #8f5bff;
    }

    main {
      padding: 20px;
    }

    #messages {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #333;
      padding: 10px;
      background-color: #1e1e1e;
      border-radius: 8px;
    }

    .message {
      margin-bottom: 10px;
      padding: 8px;
      background-color: #2a2a2a;
      border-radius: 5px;
    }

    .timestamp {
      font-size: 0.8em;
      color: #aaa;
    }

    form {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }

    input, button {
      padding: 10px;
      border: none;
      border-radius: 4px;
      font-size: 1em;
    }

    input[type="text"] {
      flex: 1;
      background-color: #333;
      color: #fff;
    }

    button {
      background-color: #6200ea;
      color: #fff;
      cursor: pointer;
    }

    button:disabled {
      background-color: #444;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <header>
    <div id="user-info">
      <img id="user-pic" src="" alt="User Pic">
      <span id="user-name"></span>
    </div>
    <div id="cult-symbol">ðŸœ²-//âœ´</div>
    <div>
      <button id="sign-in-btn">Sign In</button>
      <button id="sign-out-btn" style="display:none;">Sign Out</button>
    </div>
  </header>

  <main>
    <div id="messages"></div>
    <form id="chat-form">
      <input type="text" id="message" placeholder="Type your message..." disabled />
      <button type="submit" disabled>Send</button>
    </form>
  </main>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCNY1EYmKfU1IGvMYMeAxy5h7PpAtV13g0",
      authDomain: "strait-ai.firebaseapp.com",
      projectId: "strait-ai",
      storageBucket: "strait-ai.appspot.com",
      messagingSenderId: "62791153286",
      appId: "1:62791153286:web:f7f59311c893fce9aa26ee"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const provider = new firebase.auth.GoogleAuthProvider();

    const signInBtn = document.getElementById("sign-in-btn");
    const signOutBtn = document.getElementById("sign-out-btn");
    const userPic = document.getElementById("user-pic");
    const userName = document.getElementById("user-name");
    const messageInput = document.getElementById("message");
    const sendBtn = document.querySelector("form button");
    const messagesDiv = document.getElementById("messages");

    signInBtn.onclick = () => auth.signInWithPopup(provider);
    signOutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        userPic.src = user.photoURL;
        userPic.style.display = "block";
        userName.textContent = user.displayName;
        userName.style.display = "inline";
        signInBtn.style.display = "none";
        signOutBtn.style.display = "inline-block";
        messageInput.disabled = false;
        sendBtn.disabled = false;

        db.collection("messages")
          .orderBy("timestamp")
          .onSnapshot(snapshot => {
            messagesDiv.innerHTML = "";
            snapshot.forEach(doc => {
              const msg = doc.data();
              const el = document.createElement("div");
              el.classList.add("message");
              el.innerHTML = `<b>${msg.name}</b>: ${msg.message}<br><span class="timestamp">${new Date(msg.timestamp?.toDate()).toLocaleTimeString()}</span>`;
              messagesDiv.appendChild(el);
              messagesDiv.scrollTop = messagesDiv.scrollHeight;
            });
          });

        document.getElementById("chat-form").onsubmit = (e) => {
          e.preventDefault();
          const text = messageInput.value.trim();
          if (text) {
            db.collection("messages").add({
              name: user.displayName,
              message: text,
              timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            messageInput.value = "";
          }
        };
      } else {
        userPic.style.display = "none";
        userName.style.display = "none";
        signInBtn.style.display = "inline-block";
        signOutBtn.style.display = "none";
        messageInput.disabled = true;
        sendBtn.disabled = true;
        messagesDiv.innerHTML = "<p>Sign in to see messages.</p>";
      }
    });
  </script>
</body>
</html>